@page
@model AutoRepairCore.Pages.ServiceOrders.DeleteModel
@{
    ViewData["Title"] = $"Eliminar Orden #{Model.ServiceOrder.Folio}";
    var order = Model.ServiceOrder;
}

<div class="d-flex align-items-center mb-4 gap-2">
    <i class="bi bi-trash3 fs-3 text-danger"></i>
    <h2 class="mb-0">Eliminar Orden <span class="text-muted fs-4">#@order.Folio</span></h2>
</div>

<div class="alert alert-danger d-flex align-items-center gap-2" role="alert">
    <i class="bi bi-exclamation-triangle-fill fs-5"></i>
    <div>¿Está seguro que desea eliminar esta orden de servicio? <strong>Esta acción no se puede deshacer.</strong></div>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-danger text-white fw-bold">
        <i class="bi bi-info-circle me-1"></i> Datos de la Orden
    </div>
    <div class="card-body p-0">
        <table class="table table-bordered mb-0">
            <tr>
                <th class="text-end bg-light" style="width:180px">FOLIO:</th>
                <td><strong>#@order.Folio</strong></td>
            </tr>
            <tr>
                <th class="text-end bg-light">FECHA DE ENTRADA:</th>
                <td>@order.EntryDate.ToString("dd/MM/yyyy HH:mm")</td>
            </tr>
            <tr>
                <th class="text-end bg-light">ENTREGA ESTIMADA:</th>
                <td>@order.EstimatedDeliveryTime.ToString("dd/MM/yyyy HH:mm")</td>
            </tr>
            <tr>
                <th class="text-end bg-light">ESTADO:</th>
                <td><span class="badge bg-secondary fs-6">@order.State</span></td>
            </tr>
            <tr>
                <th class="text-end bg-light">CLIENTE:</th>
                <td>
                    <span class="badge bg-secondary fs-6">RFC: @order.Vehicle.Customer.RFC</span>
                    &nbsp;<span class="fw-semibold">@order.Vehicle.Customer.Name @order.Vehicle.Customer.FirstLastname</span>
                    <span class="text-muted ms-2 small"><i class="bi bi-telephone"></i> @order.Vehicle.Customer.MainPhone</span>
                </td>
            </tr>
            <tr>
                <th class="text-end bg-light">VEHÍCULO:</th>
                <td>
                    <span class="fw-semibold">@order.Vehicle.Brand @order.Vehicle.Model</span>
                    <span class="badge bg-light text-dark border ms-1">@order.Vehicle.PlateNumber</span>
                    <span class="text-muted ms-1">(@order.Vehicle.Year)</span>
                </td>
            </tr>
            <tr>
                <th class="text-end bg-light">COSTO TOTAL:</th>
                <td><strong class="text-danger fs-5">$@order.Cost.ToString("N2")</strong></td>
            </tr>
        </table>
    </div>
</div>

<form method="post" id="deleteForm">
    <input type="hidden" asp-for="ServiceOrder.Folio" />
    <div class="d-flex gap-2">
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
            <i class="bi bi-trash me-1"></i>Eliminar Orden
        </button>
        <a asp-page="./Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left me-1"></i>Cancelar
        </a>
        <a asp-page="./Details" asp-route-id="@order.Folio" class="btn btn-outline-info">
            <i class="bi bi-eye me-1"></i>Ver Detalles
        </a>
    </div>
</form>

<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="bi bi-exclamation-triangle me-1"></i> Confirmar Eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>¿Está absolutamente seguro que desea eliminar la orden <strong>#@order.Folio</strong>?</p>
                <p class="text-danger mb-0"><i class="bi bi-exclamation-triangle me-1"></i>Esta acción no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>No, Cancelar
                </button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                    <i class="bi bi-trash me-1"></i>Sí, Eliminar
                </button>
                <button type="button" class="btn btn-danger d-none" id="deletingBtn" disabled>
                    <span class="spinner-border spinner-border-sm me-2"></span>Eliminando...
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $('#confirmDeleteBtn').click(function () {
            $(this).addClass('d-none');
            $('#deletingBtn').removeClass('d-none');
            $('#deleteForm').submit();
        });
    </script>
}
