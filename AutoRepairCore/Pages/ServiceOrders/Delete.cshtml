@page
@model AutoRepairCore.Pages.ServiceOrders.DeleteModel
@{
    ViewData["Title"] = "Eliminar Orden";
}

<h1>Eliminar Orden de Servicio</h1>

<div class="alert alert-danger">
    <h4 class="alert-heading"><i class="bi bi-exclamation-triangle"></i> ¡Advertencia!</h4>
    <p>¿Está seguro que desea eliminar esta orden de servicio?</p>
    <hr>
    <p class="mb-0">Esta acción no se puede deshacer.</p>
</div>

<div class="card">
    <div class="card-header bg-danger text-white">
        <h4 class="mb-0">Folio: @Model.ServiceOrder.Folio</h4>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h5>Información del Cliente</h5>
                <dl class="row">
                    <dt class="col-sm-4">Nombre:</dt>
                    <dd class="col-sm-8">@Model.ServiceOrder.Vehicle.Customer.Name @Model.ServiceOrder.Vehicle.Customer.FirstLastname</dd>
                    
                    <dt class="col-sm-4">RFC:</dt>
                    <dd class="col-sm-8">@Model.ServiceOrder.Vehicle.Customer.RFC</dd>

                    <dt class="col-sm-4">Teléfono:</dt>
                    <dd class="col-sm-8">@Model.ServiceOrder.Vehicle.Customer.MainPhone</dd>
                </dl>

                <h5 class="mt-4">Información del Vehículo</h5>
                <dl class="row">
                    <dt class="col-sm-4">Vehículo:</dt>
                    <dd class="col-sm-8">@Model.ServiceOrder.Vehicle.Brand @Model.ServiceOrder.Vehicle.Model</dd>
                    
                    <dt class="col-sm-4">Placas:</dt>
                    <dd class="col-sm-8">@Model.ServiceOrder.Vehicle.PlateNumber</dd>

                    <dt class="col-sm-4">Año:</dt>
                    <dd class="col-sm-8">@Model.ServiceOrder.Vehicle.Year</dd>
                </dl>
            </div>

            <div class="col-md-6">
                <h5>Información de la Orden</h5>
                <dl class="row">
                    <dt class="col-sm-5">Fecha de Entrada:</dt>
                    <dd class="col-sm-7">@Model.ServiceOrder.EntryDate.ToString("dd/MM/yyyy HH:mm")</dd>
                    
                    <dt class="col-sm-5">Entrega Estimada:</dt>
                    <dd class="col-sm-7">@Model.ServiceOrder.EstimatedDeliveryTime.ToString("dd/MM/yyyy HH:mm")</dd>

                    @if (Model.ServiceOrder.DeliveryTime.HasValue)
                    {
                        <dt class="col-sm-5">Fecha de Entrega:</dt>
                        <dd class="col-sm-7">@Model.ServiceOrder.DeliveryTime.Value.ToString("dd/MM/yyyy HH:mm")</dd>
                    }
                    
                    <dt class="col-sm-5">Estado:</dt>
                    <dd class="col-sm-7">
                        <span class="badge bg-secondary">@Model.ServiceOrder.State</span>
                    </dd>
                    
                    <dt class="col-sm-5">Costo Total:</dt>
                    <dd class="col-sm-7"><strong>$@Model.ServiceOrder.Cost.ToString("N2")</strong></dd>
                </dl>
            </div>
        </div>
    </div>
</div>

<form method="post" class="mt-3" id="deleteForm">
    <input type="hidden" asp-for="ServiceOrder.Folio" />
    <button type="button" class="btn btn-danger" id="deleteBtn" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
        <i class="bi bi-trash"></i> Eliminar Orden
    </button>
    <a asp-page="./Index" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Cancelar
    </a>
    <a asp-page="./Details" asp-route-id="@Model.ServiceOrder.Folio" class="btn btn-info">
        <i class="bi bi-eye"></i> Ver Detalles
    </a>
</form>

<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar Eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>¿Está absolutamente seguro que desea eliminar esta orden?</strong></p>
                <p>Esta acción eliminará permanentemente la orden de servicio <strong>#@Model.ServiceOrder.Folio</strong>.</p>
                <p class="text-danger mb-0"><i class="bi bi-exclamation-triangle"></i> Esta acción no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> No, Cancelar
                </button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                    <i class="bi bi-trash"></i> Sí, Eliminar
                </button>
                <button type="button" class="btn btn-danger d-none" id="deletingBtn" disabled>
                    <span class="spinner-border spinner-border-sm me-2"></span>
                    Eliminando...
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('#confirmDeleteBtn').click(function() {
                $(this).addClass('d-none');
                $('#deletingBtn').removeClass('d-none');
                $('#deleteForm').submit();
            });
        });
    </script>
}
